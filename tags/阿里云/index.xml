<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>阿里云 on ephz3nt</title><link>https://painso.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/</link><description>Recent content in 阿里云 on ephz3nt</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Thu, 29 Oct 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://painso.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/index.xml" rel="self" type="application/rss+xml"/><item><title>Vue上传阿里云OSS问题</title><link>https://painso.com/posts/tech/2020/vue-upload-aliyun-oss-issue/</link><pubDate>Thu, 29 Oct 2020 00:00:00 +0000</pubDate><guid>https://painso.com/posts/tech/2020/vue-upload-aliyun-oss-issue/</guid><description>前段时间部署前端同事的 Vue 代码遇到的，记录一下。
问题概述 前端同事在vue.config.js配置了 OSS 的 proxy
&amp;#34;/ossUpload&amp;#34;: { target: &amp;#34;https://xxx-proj.oss-cn-shanghai.aliyuncs.com&amp;#34;, changeOrigin: true, ws: true, pathRewrite: { &amp;#34;^/ossUpload&amp;#34;: &amp;#34;&amp;#34;, }, }, 由于 Vue 编译后为纯静态文件，导致我部署到 Nginx 访问不到这个/ossUpload路径，于是只能加个proxy_pass规则。
location ^~/ossUpload { proxy_pass https://xxx-proj.oss-cn-shanghai.aliyuncs.com/; 加上后发现上传报错，直接在 Vue 启动开发模式发现上传 OSS 的状态码是204, 看到这个想到websocket的配置需要设置http_upgrade的一些配置，于是配置上去正常上传了。 最终 Nginx 配置如下
location ^~/ossUpload { proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-NginX-Proxy true; proxy_redirect off; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &amp;quot;upgrade&amp;quot;; proxy_pass https://xxx-proj.oss-cn-shanghai.aliyuncs.com/; 时间过去比较久， 一些细节忘记了 - -</description></item></channel></rss>
<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content=#494f5c><meta name=msapplication-TileColor content=#494f5c><meta itemprop=name content=IP网络存储iSCSI小试。><meta itemprop=description content="iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI技术是一种新储存技术，该技术是将现有SCSI接口与以太网络(Ethernet)技术结合，使服务器可与使用IP网络的储存装置互相交换资料。(详见百科)
搭建环境：
177.208.11.199 iSCSI-Enterprise-Target - CentOS6.4 - 32 177.208.11.234 iSCSI-initiator-utils - CentOS6.4 - 32 177.208.11.103 iSCSI-Initiator - Windows Server 2003 Enterprise Edition SP2
以下以IP后3位为简称吧
199为iSCSI服务端，其他2台分别为客户端，我这里的服务端只是测试用所以只有一块普通的硬盘，如果用户生产环境的话可能需要做一些集群或者RAID之类的，现在开始吧。
首先在199(Target端)安装服务端软件：
你可以在官方网站获取：http://iscsitarget.sf.net
[root@localhost ~]# tar zxvf iscsitarget-1.4.20.2.tar.gz [root@localhost ~]# cd iscsitarget-1.4.20.2 [root@localhost iscsitarget-1.4.20.2]# make  这里我编译报错：
make[1]: Leaving directory `/root/iscsitarget-1.4.20.2/usr' make -C /lib/modules/2.6.32-358.14.1.el6.i686/build SUBDIRS=/root/iscsitarget-1.4.20.2/kernel modules make: *** /lib/modules/2.6.32-358.14.1.el6.i686/build: No such file or directory. Stop. make: *** [kernel] Error 2  安装kernel-devel和patch
[root@localhost iscsitarget-1.4.20.2]# yum -y install kernel kernel-devel patch [root@localhost iscsitarget-1."><meta itemprop=datePublished content=2013-10-28T02:41:16&#43;00:00><meta itemprop=dateModified content=2013-10-28T02:41:16&#43;00:00><meta itemprop=wordCount content=234><meta itemprop=keywords content=CentOS,iSCSI,网络存储,><meta property=og:title content=IP网络存储iSCSI小试。><meta property=og:description content="iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI技术是一种新储存技术，该技术是将现有SCSI接口与以太网络(Ethernet)技术结合，使服务器可与使用IP网络的储存装置互相交换资料。(详见百科)
搭建环境：
177.208.11.199 iSCSI-Enterprise-Target - CentOS6.4 - 32 177.208.11.234 iSCSI-initiator-utils - CentOS6.4 - 32 177.208.11.103 iSCSI-Initiator - Windows Server 2003 Enterprise Edition SP2
以下以IP后3位为简称吧
199为iSCSI服务端，其他2台分别为客户端，我这里的服务端只是测试用所以只有一块普通的硬盘，如果用户生产环境的话可能需要做一些集群或者RAID之类的，现在开始吧。
首先在199(Target端)安装服务端软件：
你可以在官方网站获取：http://iscsitarget.sf.net
[root@localhost ~]# tar zxvf iscsitarget-1.4.20.2.tar.gz [root@localhost ~]# cd iscsitarget-1.4.20.2 [root@localhost iscsitarget-1.4.20.2]# make  这里我编译报错：
make[1]: Leaving directory `/root/iscsitarget-1.4.20.2/usr' make -C /lib/modules/2.6.32-358.14.1.el6.i686/build SUBDIRS=/root/iscsitarget-1.4.20.2/kernel modules make: *** /lib/modules/2.6.32-358.14.1.el6.i686/build: No such file or directory. Stop. make: *** [kernel] Error 2  安装kernel-devel和patch
[root@localhost iscsitarget-1.4.20.2]# yum -y install kernel kernel-devel patch [root@localhost iscsitarget-1."><meta property=og:type content=article><meta property=og:url content=https://painso.com/posts/tech/2013/iscsi-experiment/><meta property=article:published_time content=2013-10-28T02:41:16+00:00><meta property=article:modified_time content=2013-10-28T02:41:16+00:00><meta name=twitter:card content=summary><meta name=twitter:title content=IP网络存储iSCSI小试。><meta name=twitter:description content="iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI技术是一种新储存技术，该技术是将现有SCSI接口与以太网络(Ethernet)技术结合，使服务器可与使用IP网络的储存装置互相交换资料。(详见百科)
搭建环境：
177.208.11.199 iSCSI-Enterprise-Target - CentOS6.4 - 32 177.208.11.234 iSCSI-initiator-utils - CentOS6.4 - 32 177.208.11.103 iSCSI-Initiator - Windows Server 2003 Enterprise Edition SP2
以下以IP后3位为简称吧
199为iSCSI服务端，其他2台分别为客户端，我这里的服务端只是测试用所以只有一块普通的硬盘，如果用户生产环境的话可能需要做一些集群或者RAID之类的，现在开始吧。
首先在199(Target端)安装服务端软件：
你可以在官方网站获取：http://iscsitarget.sf.net
[root@localhost ~]# tar zxvf iscsitarget-1.4.20.2.tar.gz [root@localhost ~]# cd iscsitarget-1.4.20.2 [root@localhost iscsitarget-1.4.20.2]# make  这里我编译报错：
make[1]: Leaving directory `/root/iscsitarget-1.4.20.2/usr' make -C /lib/modules/2.6.32-358.14.1.el6.i686/build SUBDIRS=/root/iscsitarget-1.4.20.2/kernel modules make: *** /lib/modules/2.6.32-358.14.1.el6.i686/build: No such file or directory. Stop. make: *** [kernel] Error 2  安装kernel-devel和patch
[root@localhost iscsitarget-1.4.20.2]# yum -y install kernel kernel-devel patch [root@localhost iscsitarget-1."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>IP网络存储iSCSI小试。</title><link rel=stylesheet href=https://painso.com/css/style.min.adb4e738c83b4cc0eea8000ca83f72188a2ac1fd188a1e6f7cea8a7fa75cd7b1.css integrity="sha256-rbTnOMg7TMDuqAAMqD9yGIoqwf0Yih5vfOqKf6dc17E=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://painso.com>ephz3nt</a></div><nav class="site-nav hide-in-mobile"><a href=https://painso.com/posts/>Posts</a>
<a href=https://painso.com/about-me/>About</a></nav></div><div class="hdr-right hdr-icons"><span class="hdr-social hide-in-mobile"><a href=https://github.com/ephz3nt target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a></span><button id=menu-btn class=hdr-btn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><path d="M3 12H21z"/><path d="M3 6H21z"/><path d="M3 18H21z"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://painso.com/posts/>Posts</a></li><li><a href=https://painso.com/about-me/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Oct 28, 2013</span></div><h1>IP网络存储iSCSI小试。</h1></header><div class=content><p>iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI技术是一种新储存技术，该技术是将现有SCSI接口与以太网络(Ethernet)技术结合，使服务器可与使用IP网络的储存装置互相交换资料。(详见百科)</p><p>搭建环境：</p><p>177.208.11.199 iSCSI-Enterprise-Target - CentOS6.4 - 32
177.208.11.234 iSCSI-initiator-utils - CentOS6.4 - 32
177.208.11.103 iSCSI-Initiator - Windows Server 2003 Enterprise Edition SP2</p><p>以下以IP后3位为简称吧</p><p>199为iSCSI服务端，其他2台分别为客户端，我这里的服务端只是测试用所以只有一块普通的硬盘，如果用户生产环境的话可能需要做一些集群或者RAID之类的，现在开始吧。</p><p>首先在199(Target端)安装服务端软件：</p><p>你可以在官方网站获取：<a href=http://iscsitarget.sf.net/>http://iscsitarget.sf.net</a></p><pre><code>[root@localhost ~]# tar zxvf iscsitarget-1.4.20.2.tar.gz
[root@localhost ~]# cd iscsitarget-1.4.20.2
[root@localhost iscsitarget-1.4.20.2]# make
</code></pre><p>这里我编译报错：</p><pre><code>make[1]: Leaving directory `/root/iscsitarget-1.4.20.2/usr'
make -C /lib/modules/2.6.32-358.14.1.el6.i686/build SUBDIRS=/root/iscsitarget-1.4.20.2/kernel modules
make: *** /lib/modules/2.6.32-358.14.1.el6.i686/build: No such file or directory.  Stop.
make: *** [kernel] Error 2
</code></pre><p>安装kernel-devel和patch</p><pre><code>[root@localhost iscsitarget-1.4.20.2]# yum -y install kernel kernel-devel patch
[root@localhost iscsitarget-1.4.20.2]# reboot
</code></pre><pre><code>[root@localhost iscsitarget-1.4.20.2]# rm -rf /lib/modules/`uname -r`/build
[root@localhost iscsitarget-1.4.20.2]# ln -s /usr/src/kernels/2.6.32-358.23.2.el6.i686/ /lib/modules/`uname -r`/build
[root@localhost iscsitarget-1.4.20.2]# make clean
[root@localhost iscsitarget-1.4.20.2]# make
[root@localhost iscsitarget-1.4.20.2]# make install
</code></pre><p>现在iscsitarget就已经安装好了，配置文件位置在: /etc/iet/ietd.conf
编辑该配置文件找到类似 Target iqn.2001-04.com.example:storage.disk2.sys1.xyz 行取消注释</p><p><img src=/images/2013/10/iscsi-conf1.jpg alt=iscsi-conf1></p><p>命名格式：<code>iqn.yyyy-mm.&lt;recversed domain name(倒过来写的域名)&gt;[:identifier]</code>
如：<code>Target iqn.2013-10.net.hacache.iscsi:storage.disk2.sys1.xyz</code>
找到类似<code> Lun 0 Path=/dev/sdc,Type=fileio,ScsiId=xyz,ScsiSN=xyz</code>行取消注释
<code>Lun 0 Path=/dev/sdc</code>，表示块设备0，映射的磁盘为/dev/sdc ，简单来说把/dev/sdc修改成你自己需要共享出去的磁盘路径就好了。
如：<code>Lun 0 Path=/dev/xvde,Type=fileio,ScsiId=xyz,ScsiSN=xyz</code></p><pre><code>[root@localhost iscsitarget-1.4.20.2]# service iscsi-target restart

Stopping iSCSI Target: Connection refused.
ietd: no process killed
                                                           [FAILED]
Starting iSCSI Target:                                     [  OK  ]
</code></pre><p>iSCSI-Target服务默认端口3260</p><p>这样一台简单的iSCSI服务器就已经搭建好了，现在我们来分别在windows和linux上添加target端(199)的磁盘</p><p>Windows：</p><p>需要安装iSCSI Initiator</p><p>可以在这里获取：<a href="http://www.microsoft.com/en-us/download/details.aspx?id=18986">http://www.microsoft.com/en-us/download/details.aspx?id=18986</a></p><p>选择相应的版本下载和安装完毕打开桌面上的Microsoft iSCSI Initiator</p><p><a href=/images/2013/10/iscsi-win.jpg><img src=/images/2013/10/iscsi-win-300x263.jpg alt=iscsi-win></a>
如图，选择Discovery选项在Target Portals部分单击add按钮，输入iSCSI Target端的IP地址再单击OK即可</p><p>然后在Targets选项卡已经可以看到检测出的iSCSI Target的名称了但是还是inactive的状态</p><p><a href=/images/2013/10/iscsi-win2.jpg><img src=/images/2013/10/iscsi-win2-300x285.jpg alt=iscsi-win2></a>
点击Log On按钮再次点击确定，现在已经变成Connected状态了</p><p><a href=/images/2013/10/iscsi-win3.jpg><img src=/images/2013/10/iscsi-win3-251x300.jpg alt=iscsi-win3></a></p><p>现在你已经可以在windows的磁盘管理器中对新添加的共享磁盘进行分区、格式化等操作了。</p><p><a href=/images/2013/10/iscsi-win4.jpg><img src=/images/2013/10/iscsi-win4-300x209.jpg alt=iscsi-win4></a></p><p>Linux：</p><p>Linux中也同样需要安装客户端软件，在CentOS中可使用yum进行安装</p><pre><code>[root@centos5 ~]# yum -y install iscsi-initiator-utils*
</code></pre><p>可以使用 rpm -ql iscsi-initiator-utils 来查看它安装了哪些程序</p><p>iscsi-initiator-utils使用比较多的就是iscsiadm命令了</p><p>现在开始挂载Target端的共享磁盘</p><p>使用 iscsiadm -m discovery &ndash;type sendtargets &ndash;portal IP地址 来搜索iSCSI Target主机划分了哪些lun</p><p><a href=/images/2013/10/iscsiadm.jpg><img src=/images/2013/10/iscsiadm-300x77.jpg alt=iscsiadm></a></p><p>如图，已经搜索出来了我在199上共享出来的磁盘，现在开始连接它</p><p>可以使用  iscsiadm -m node -T [target-name] -p [ip-address] -l 格式连接</p><p>如：iscsiadm -m node -T iqn.2013-10.net.hacache.iscsi:storage.disk2.sys1.xyz -p 177.208.11.199 -l</p><p><a href=/images/2013/10/iscsiadm1.jpg><img src=/images/2013/10/iscsiadm1-300x69.jpg alt=iscsiadm1></a></p><p>可以看到图中我已经连接成功了，</p><p><a href=/images/2013/10/iscsiadm2.jpg><img src=/images/2013/10/iscsiadm2-300x190.jpg alt=iscsiadm2></a></p><p>使用fdisk -l 可以看到我已经多出了一块名为sdb的64G的磁盘</p><p>其他配置：</p><p>iSCSI-Target主机以IP认证方式获取资源</p><p>编辑/etc/iet/ietd.conf</p><pre><code>Target iqn.2013-10.net.hacache.iscsi:xvde1
Lun 0 Path=/dev/xvde1,Type=fileio
Target iqn.2013-10.net.hacache.iscsi:xvde2
Lun 0 Path=/dev/xvde2,Type=fileio
Target iqn.2013-10.net.hacache.iscsi:xvde3
Lun 0 Path=/dev/xvde3,Type=fileio
</code></pre><p>编辑/etc/iet/initiator.allow</p><p>注释掉ALL.ALL</p><p>添加如下格式的配置重启服务即可完成基于IP的资源验证</p><pre><code>iqn.2013-10.net.hacache.iscsi:xvde1 192.168.0.11
iqn.2013-10.net.hacache.iscsi:xvde2 192.168.0.12
iqn.2013-10.net.hacache.iscsi:xvde3 177.208.11.68
</code></pre></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg><span class=tag><a href=https://painso.com/tags/centos>CentOS</a></span><span class=tag><a href=https://painso.com/tags/iscsi>iSCSI</a></span><span class=tag><a href=https://painso.com/tags/%E7%BD%91%E7%BB%9C%E5%AD%98%E5%82%A8>网络存储</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2V8h6"/><path d="M16 13H8z"/><path d="M16 17H8z"/><path d="M10 9H9 8"/></svg></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><path d="M16 2V6z"/><path d="M8 2V6z"/><path d="M3 10H21z"/></svg>2013-10-28 02:41 &#43;0000</p></footer></article><div class="post-nav thin"><a class=next-post href=https://painso.com/posts/thinking/2014/2014-new-year/><span class=post-nav-label><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><path d="M19 12H5z"/><path d="M12 19 5 12l7-7"/></svg>&nbsp;</span><br><span>新年快乐。</span></a>
<a class=prev-post href=https://painso.com/posts/tech/2013/centos-install-desktop/><span class=post-nav-label>&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><path d="M5 12H19z"/><path d="M12 5l7 7-7 7"/></svg></span><br><span>CentOS桌面环境安装</span></a></div><div id=comments class=thin><div id=utter-container></div><script src=https://utteranc.es/client.js repo=ephz3nt/blog-comments issue-term=title theme=github-light crossorigin=anonymous async></script></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://painso.com>ephz3nt</a> &#183; <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank rel=noopener>CC BY-NC 4.0</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://painso.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://painso.com/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-56069703-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>